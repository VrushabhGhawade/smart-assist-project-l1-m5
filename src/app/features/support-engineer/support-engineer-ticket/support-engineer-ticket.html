<div class="dashboard-container">
    <header class="page-header">
        <h1>My Tickets</h1>
        <p class="role-subtitle">Tickets assigned to me</p>
    </header>
    @if (tickets) {
    <table mat-table [dataSource]="tickets" class="support-table">

        <ng-container matColumnDef="createdBy">
            <th mat-header-cell *matHeaderCellDef> Created By </th>
            <td mat-cell *matCellDef="let t"> {{getByUserName(t.createdByUserId)}} </td>
        </ng-container>

        <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Title </th>
            <td mat-cell *matCellDef="let t">
                <button mat-button color="primary" (click)="onTicketSelcted(t.ticketId)">
                {{ t.title }}
              </button>
                @if (t.hasAttachment) {
                <br><a href="#" class="attachment-link">Attachment</a>
                }
            </td>
        </ng-container>

        <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef> Priority </th>
            <td mat-cell *matCellDef="let t"> {{ticketPriority[t.priority]}} </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let t"> {{statusEnum[t.status]}} </td>
        </ng-container>

        <ng-container matColumnDef="age">
            <th mat-header-cell *matHeaderCellDef> Age </th>
            <td mat-cell *matCellDef="let t"> {{t.createdAt | age}} </td>
        </ng-container>

        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let t">
                <div class="action-group">

                    @if (t.status === statusEnum.New) {
                    <button mat-button color="primary"><mat-icon>person_add</mat-icon> Assign</button>
                    }

                    @if (t.status === statusEnum.Assigned) {
                    <button mat-button class="success-btn"><mat-icon>check_circle</mat-icon> Resolve</button>
                    <button mat-button color="accent"><mat-icon>assignment_ind</mat-icon> Delegate</button>
                    <button mat-button color="primary"><mat-icon>add_circle</mat-icon> Request More Input</button>
                    }

                    @if (t.status === statusEnum.Input_Requested) {
                    <button mat-button class="success-btn"><mat-icon>check_circle</mat-icon> Resolve</button>
                    }

                    @if (t.status === statusEnum.Feedback_Received) {
                    <button mat-button color="warn"><mat-icon>cancel</mat-icon> Close</button>
                    }

                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    }
    @else {
        <p class="no-data">
            No tickets found for this user.
        </p>
    }
</div>